<block>
  <nav-bar navInfo="交易房间" />
  <view class="nookeaGoods" style="min-height: calc(100vh - {{statusBarHeight}}px - 44px)">
    <view class="header"></view>

    <view class="item-box">
      <view class="item-img-box">
        <image class="item-img" src="{{db.itemInfo.img_url}}" mode="heightFix"></image>
      </view>
      <view>{{db.itemInfo.zh_name}}</view>
    </view>

    <view class="master-info">
      <view class="avatar">
        <image class="avatar-img" src="{{db.masterInfo.avatarInfo}}"></image>
      </view>
      <view class="master-info-detail">
        <view class="master-name">
          {{db.masterInfo.nickName}}
        </view>
        <view class="master-island">
          {{db.masterInfo.islandName}}
        </view>
      </view>
    </view>

    <view class="content">
      {{db.content}}
    </view>

    <view class="board">
      <view class="board-options" wx:if="{{addReplyEnabled}}">
        <button bindtap="modalShow">添加回复</button>
      </view>
      <view class="board-content" wx:for="{{db.notes}}">
        <view class="conversation" wx:for="{{item.conversations}}" wx:for-item="conversation" wx:for-index="conversationIndex">
          <view class="userinfo" wx:if="{{conversation.isMaster}}">
            <view class="avatar">
              <image class="avatar-img" src="{{db.masterInfo.avatarInfo}}"></image>
            </view>
            <view class="master-info-detail">
              <view class="master-name">
                {{db.masterInfo.nickName}}
              </view>
              <view class="master-island">
                {{db.masterInfo.islandName}}
              </view>
            </view>
          </view>
          <view class="userinfo" wx:else>
            <view class="avatar">
              <image class="avatar-img" src="{{item.slaveInfo.avatarInfo}}"></image>
            </view>
            <view class="master-info-detail">
              <view class="master-name">
                {{item.slaveInfo.nickName}}
              </view>
              <view class="master-island">
                {{item.slaveInfo.islandName}}
              </view>
            </view>
          </view>
          
          <view class="conversation-content">
            {{conversation.content}}
          </view>
        </view>
        <view class="reply-btn-view" wx:if="{{openid == db.masterInfo._openid || openid == item.slaveInfo._openid}}">
          <button class="reply-btn" data-index="{{item.noteIndex}}" bindtap="modalShow">添加回复</button>
        </view>
      </view>
    </view>
  </view>
  <!-- mask -->
  <view class="mask" wx:if="{{showModal}}" bindtap="modalHide" />
  <!-- modal -->
  <view class="mymodal fade-in" wx:if="{{showModal}}">
    <view class="modal-text">添加回复</view>
    <view>
      <input bindinput="replyText" class="input-reply"></input>
    </view>
    <view class="modal-options">
      <view class="modal-btn" bindtap="modalHide">返回</view>
      <view class="modal-btn" bindtap="onTapClose">确定</view>
    </view>
  </view>
</block>